"0","#beer_k is now a list of IPAs and Ales with ABV values, IBU values, and no NA values. Now it's time to develop a training and test set. Training set taken from cleaned data"
"0","mbeer$isipa <- as.numeric(str_detect(mbeer$Style, ""IPA""))"
"0","mbeer$isale <- as.numeric(str_detect(mbeer$Style, ""Ale""))"
"0","ipa_k <- mbeer %>% filter(mbeer$isipa == 1)"
"0","ale_k <- mbeer %>% filter(mbeer$isale==1)"
"0","ipa_k <- ipa_k[,c(4, 5, 11)]"
"0","ale_k <- ale_k[,c(4, 5, 11)]"
"0","beer_k <- merge(ipa_k, ale_k, all=TRUE)"
"0","beer_k <- beer_k[complete.cases(beer_k),]"
"0","beer_k$isipa <- as.factor(beer_k$isipa)"
"0","train <- beer_k[sample(nrow(beer_k), size=311),]"
"0","test <- setdiff(beer_k, train)"
"0","#--------------HYPERPARAMETER K TESTING--------------"
"0","#-----define parameters-----"
"0","kmax=25"
"0","loops=100"
"0","accs1 = data.frame(k = numeric(kmax), accuracy = numeric(kmax), accuracy2=numeric(kmax))"
"0","accs2 = data.frame(k = numeric(kmax), accuracy = numeric(kmax), accuracy2=numeric(kmax))"
"0","#-----define loop-----"
"0","#housed processes to speed compile time"
"0","#each loop processes train vs test and then icv"
"0","for(j in 1:loops){"
"0","  train <- beer_k[sample(nrow(beer_k), size=311),]"
"0","  test <- setdiff(beer_k, train)"
"0","for(i in 1:kmax)"
"0","{"
"0","  classifications1 = knn(train[,c(1,2)],test[,c(1,2)],train[,3], prob = TRUE, k = i)"
"0","  sur1 = table(test[,3],classifications1)"
"0","  CM1 = confusionMatrix(sur1)"
"0","  accs1$accuracy[i] = accs1$accuracy[i] + CM1$overall[1]"
"0","  accs1$k[i] = i"
"0","  "
"0","  classifications2 = knn.cv(beer_k[,c(1,2)], beer_k[,3], prob=TRUE, k=i)"
"0","  sur2 = table(beer_k[,3],classifications2)"
"0","  CM2 = confusionMatrix(sur2)"
"0","  accs2$accuracy[i] = accs2$accuracy[i] + CM2$overall[1]"
"0","  accs2$k[i] = i"
"0","  "
"0","  }"
"0","}"
"0","#finish the calculation of averages"
"0","accs1$accuracy <- accs1$accuracy/loops"
"0","accs2$accuracy <- accs2$accuracy/loops"
"0","#-----build plots-----"
"0","fig_7 <- ggplot(data=accs1, aes(x=k, y=accuracy)) +"
"0","  geom_point() +"
"0","  geom_text(aes(label=accs1$k), hjust=-.2, size=2.7)+"
"0","  labs(title = ""Figure 7"","
"0","       subtitle = ""Train and Test Hyperparameter K: 100 Iterations"","
"0","       caption = ""Source: Breweries.csv \n Author: Jules Stacy"","
"0","       x = ""Hyperparameter K"","
"0","       y = ""Average Accuracy"")"
"0","fig_8 <- ggplot(data=accs2, aes(x=k, y=accuracy)) +"
"0","  geom_point() +"
"0","  geom_text(aes(label=accs2$k), hjust=-.2, size=2.7)+"
"0","  labs(title = ""Figure 8"","
"0","       subtitle = ""Leave One Out Hyperparameter K: 100 Iterations"","
"0","       caption = ""Source: Breweries.csv \n Author: Jules Stacy"","
"0","       x = ""Hyperparameter K"","
"0","       y = ""Average Accuracy"")"
"0","#------------------------------------"
"0","#the best k for train-and-test is 19"
"0","#the best k for leave-one-out is 8"
